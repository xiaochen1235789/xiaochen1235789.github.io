<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å±å¯æ‹–åŠ¨éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå«æ­Œæ›²åˆ—è¡¨+è¿›åº¦æ¡ä¿®å¤ï¼‰</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body {
            background: transparent;
            padding: 0; margin: 0;
            height: 100%;
            overflow: hidden;
        }
        /* æ’­æ”¾å™¨å®¹å™¨ï¼šé¢„ç•™è¿›åº¦æ¡ç©ºé—´ */
        .player-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 99999;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-top: 10px; /* ä¸ºè¿›åº¦æ¡ç•™é¡¶éƒ¨ç©ºé—´ */
            transition: all 0.3s ease;
        }
        .player-mini-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1e3a2f;
            border: 1px solid #3d725f;
            color: #81c784;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: none;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        .player-mini-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        /* æ’­æ”¾å™¨ä¸»ä½“ï¼šç›¸å¯¹å®šä½ï¼Œç¡®ä¿è¿›åº¦æ¡å¯¹é½ */
        .mini-music-player {
            width: 100%;
            max-width: 340px; /* åŠ å®½é€‚é…è¿›åº¦æ¡ */
            height: 60px;
            min-width: 300px;
            background: #1e3a2f;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 8px;
            border: 1px solid #3d725f;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: move;
            user-select: none;
            -webkit-user-drag: none;
            position: relative; /* è¿›åº¦æ¡ç›¸å¯¹æ­¤å…ƒç´ å®šä½ */
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
            overflow: visible !important; /* ç¡®ä¿åˆ—è¡¨ä¸è¢«è£å‰ª */
        }
        .mini-music-player:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        .player-cover {
            width: 44px;
            height: 44px;
            border-radius: 4px;
            background: #2d5243;
            overflow: hidden;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        .player-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            transition: transform 0.5s ease;
        }
        .mini-music-player.playing .player-cover img {
            transform: rotate(360deg);
        }
        .player-info {
            flex: 0 0 130px; /* åŠ å®½æ–‡æœ¬åŒºåŸŸï¼Œé¿å…æˆªæ–­ */
            flex-shrink: 0;
            pointer-events: none;
        }
        .player-title {
            font-size: 0.85rem;
            color: #81c784;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.2s ease;
        }
        .mini-music-player.playing .player-title {
            color: #a5d6a7;
        }
        .player-singer {
            font-size: 0.7rem;
            color: #99aabb;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .player-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .player-btn {
            background: transparent;
            border: none;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.9rem;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        .player-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }
        .play-main-btn {
            background: #81c784;
            color: #121212;
            font-weight: bold;
        }
        .play-main-btn:hover {
            background: #a5d6a7;
            transform: scale(1.1);
        }
        .player-volume {
            flex: 0 0 28px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        .volume-btn {
            background: transparent;
            border: none;
            color: #99aabb;
            cursor: pointer;
            font-size: 0.8rem;
            z-index: 1;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        .volume-btn:hover {
            color: #e0e0e0;
            transform: scale(1.1);
        }
        .toggle-btn {
            background: transparent;
            border: none;
            color: #99aabb;
            cursor: pointer;
            font-size: 0.9rem;
            flex-shrink: 0;
            z-index: 1;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        .toggle-btn:hover {
            color: #e0e0e0;
            transform: scale(1.05);
        }
        /* è¿›åº¦æ¡ï¼šå®Œæ•´æ˜¾ç¤º+è‡ªé€‚åº”é«˜åº¦ */
        .player-progress {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            width: 100%;
            padding: 4px 2%; /* å·¦å³ç•™è¾¹ï¼Œé¿å…è¶…å‡º */
            background: #1e3a2f;
            border-radius: 4px 4px 0 0;
            border-bottom: 1px solid #3d725f;
            box-sizing: border-box;
            min-height: 24px; /* ç¡®ä¿æ—¶é—´æ–‡å­—ä¸æŒ¤å‹ */
            transition: all 0.2s ease;
            z-index: 1; /* è¿›åº¦æ¡å±‚çº§é™ä½ï¼Œä¸é®æŒ¡åˆ—è¡¨ */
        }
        .mini-music-player:hover .player-progress {
            display: block;
        }
        .progress-bar-mini {
            width: 100%;
            height: 3px;
            background: #2d5243;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            transition: height 0.2s ease;
        }
        .progress-bar-mini:hover {
            height: 4px;
        }
        .progress-mini {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            background: #81c784;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        .time-mini {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #99aabb;
            margin-top: 2px;
            width: 100%;
        }
        /* æ­Œæ›²åˆ‡æ¢åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .player-info, .player-cover {
            animation: fadeIn 0.3s ease;
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .mini-music-player {
                width: 300px;
                gap: 6px;
            }
            .player-info {
                flex: 0 0 110px;
            }
        }
        /* æ­Œæ›²åˆ—è¡¨æ ·å¼ï¼ˆæ–°å¢æ ¸å¿ƒï¼‰ */
        #listToggleBtn {
            margin-left: 4px;
        }
        .song-list-container {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: #1e3a2f;
            border: 1px solid #3d725f;
            border-radius: 4px 4px 0 0;
            padding: 8px 0;
            z-index: 10; /* åˆ—è¡¨å±‚çº§æœ€é«˜ï¼Œä¸è¢«ä»»ä½•å…ƒç´ é®æŒ¡ */
        }
        .song-list-container.show {
            display: block;
        }
        .song-list {
            list-style: none;
        }
        .song-list li {
            padding: 6px 16px;
            color: #e0e0e0;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
            pointer-events: auto; /* ç¡®ä¿ç‚¹å‡»æœ‰æ•ˆ */
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        .song-list li.active {
            background: #2d5243;
            color: #81c784;
            font-weight: 500;
        }
        .song-list li:hover:not(.active) {
            background: #28483c;
        }
    </style>
</head>
<body>
    <div class="player-container" id="playerContainer">
        <button class="player-mini-btn" id="playerMiniBtn">â–¶</button>
        <div class="mini-music-player" id="draggablePlayer">
            <!-- ç¬¬ä¸€é¦–æ­Œå°é¢ -->
            <div class="player-cover" id="playerCover1">
                <img src="http://p2.music.126.net/BKJrPO1FlbXcy-98AYXOzg==/109951172268004943.jpg?param=300x300" alt="æ˜”æ¶Ÿ">
            </div>
            <!-- ç¬¬äºŒé¦–æ­Œå°é¢ï¼ˆå·²é—­åˆï¼‰ -->
            <div class="player-cover" id="playerCover2" style="display:none;">
                <img src="http://p2.music.126.net/DYDACa_8zB5irAOrasVgnQ==/109951171396677694.jpg?param=300x300" alt="è€€æ–‘">
            </div>
            <!-- ç¬¬ä¸‰é¦–æ­Œå°é¢ï¼ˆå·²é—­åˆï¼‰ -->
            <div class="player-cover" id="playerCover3" style="display:none;">
                <img src="http://p2.music.126.net/2qGGwWFlMYF2o-GyNMhH5A==/109951171066942237.jpg?param=300x300" alt="æ‹‚æ™“">
            </div>
            <!-- ç¬¬å››é¦–æ­Œå°é¢ï¼ˆå·²é—­åˆï¼‰ -->
            <div class="player-cover" id="playerCover4" style="display:none;">
                <img src="http://p1.music.126.net/gtunmoxObQyoH01HzURNUw==/109951170292455448.jpg?param=300x300" alt="ä½•è€…">
            </div>
            <!-- ç¬¬äº”é¦–æ­Œå°é¢ï¼ˆå·²é—­åˆï¼‰ -->
            <div class="player-cover" id="playerCover5" style="display:none;">
                <img src="http://p1.music.126.net/jWx1g4PbZsIu9npNOlifzA==/109951170151255339.jpg?param=300x300" alt="ç¡è•‰ä¹‹æ­Œ">
            </div>
            <!-- ç¬¬å…­é¦–æ­Œå°é¢ï¼ˆå·²é—­åˆï¼‰ -->
            <div class="player-cover" id="playerCover6" style="display:none;">
                <img src="http://p1.music.126.net/sZ-rACbFrybF0x_lI6XNMw==/109951169297766755.jpg?param=300x300" alt="ä¸çœ ä¹‹å¤œ">
            </div>
            <div class="player-info">
                <div class="player-title" id="playerTitle">æ˜”æ¶Ÿ</div>
                <div class="player-singer" id="playerSinger">å¼ éŸ¶æ¶µã€HOYO-MiX</div>
            </div>
            <div class="player-controls">
                <button class="player-btn" id="miniPrevBtn">â®</button>
                <button class="player-btn play-main-btn" id="miniPlayBtn">â–¶</button>
                <button class="player-btn" id="miniNextBtn">â¯</button>
            </div>
            <div class="player-volume">
                <button class="volume-btn" id="volumeBtn">ğŸ”Š</button>
            </div>
            <!-- æ­Œæ›²åˆ—è¡¨æŒ‰é’®ï¼ˆæ–‡æœ¬æ”¹ä¸ºâ€œæ­Œæ›²åˆ—è¡¨â€ï¼‰ -->
            <button class="toggle-btn" id="listToggleBtn">ğŸ“œ æ­Œæ›²åˆ—è¡¨</button>
            <button class="toggle-btn" id="toggleBtn">ã€<ã€‘æ”¶èµ· </button>
            
            <!-- è¿›åº¦æ¡ï¼ˆç§»åˆ°åˆ—è¡¨å‰é¢ï¼‰ -->
            <div class="player-progress">
                <div class="progress-bar-mini" id="miniProgressBar">
                    <div class="progress-mini" id="miniProgress"></div>
                </div>
                <div class="time-mini">
                    <span class="current-time-mini" id="currentTime">00:00</span>
                    <span class="total-time-mini" id="totalTime">03:06</span>
                </div>
            </div>
            
            <!-- æ­Œæ›²åˆ—è¡¨å®¹å™¨ï¼ˆç§»åˆ°è¿›åº¦æ¡åé¢ï¼Œå±‚çº§æ›´é«˜ï¼‰ -->
            <div class="song-list-container" id="songListContainer">
                <ul class="song-list" id="songList">
                    <!-- åˆ—è¡¨é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </ul>
            </div>
        </div>
        <!-- ç¬¬ä¸€é¦–æ­ŒéŸ³é¢‘ -->
        <audio id="miniAudio1" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=3316968660.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
         </audio>
        <!-- ç¬¬äºŒé¦–æ­ŒéŸ³é¢‘ -->
        <audio id="miniAudio2" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=2722510685.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
         </audio>
        <!-- ç¬¬ä¸‰é¦–æ­ŒéŸ³é¢‘ï¼ˆå·²é—­åˆï¼‰ -->
        <audio id="miniAudio3" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=2709812973.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
        <!-- ç¬¬å››é¦–æ­ŒéŸ³é¢‘ï¼ˆå·²é—­åˆï¼‰ -->
        <audio id="miniAudio4" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=2658660685.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
        <!-- ç¬¬äº”é¦–æ­ŒéŸ³é¢‘ï¼ˆå·²é—­åˆï¼‰ -->
        <audio id="miniAudio5" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=2646986980.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
        <!-- ç¬¬å…­é¦–æ­ŒéŸ³é¢‘ï¼ˆå·²é—­åˆï¼‰ -->
        <audio id="miniAudio6" preload="auto" playsinline>
            <source src="http://music.163.com/song/media/outer/url?id=2122308127.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
    </div>
    <script>
        // å…ƒç´ åˆå§‹åŒ–
        const playerContainer = document.getElementById('playerContainer');
        const draggablePlayer = document.getElementById('draggablePlayer');
        const playBtn = document.getElementById('miniPlayBtn');
        const toggleBtn = document.getElementById('toggleBtn');
        const playerMiniBtn = document.getElementById('playerMiniBtn');
        const progress = document.getElementById('miniProgress');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const volumeBtn = document.getElementById('volumeBtn');
        const prevBtn = document.getElementById('miniPrevBtn');
        const nextBtn = document.getElementById('miniNextBtn');
        const playerTitle = document.getElementById('playerTitle');
        const playerSinger = document.getElementById('playerSinger');
        // æ–°å¢æ­Œæ›²åˆ—è¡¨å…ƒç´ åˆå§‹åŒ–
        const listToggleBtn = document.getElementById('listToggleBtn');
        const songListContainer = document.getElementById('songListContainer');
        const songListEl = document.getElementById('songList');
        // æ­Œæ›²åˆ—è¡¨é…ç½®
        const songList = [
            {
                audioId: 'miniAudio1',
                coverId: 'playerCover1',
                title: 'æ˜”æ¶Ÿ',
                singer: 'å¼ éŸ¶æ¶µã€HOYO-MiX',
                defaultDuration: '03:06'
            },
            {
                audioId: 'miniAudio2',
                coverId: 'playerCover2',
                title: 'è€€æ–‘',
                singer: 'HOYO-MiX,YMIR',
                defaultDuration: '03:33'
            },
            {
                audioId: 'miniAudio3',
                coverId: 'playerCover3',
                title: 'æ‹‚æ™“ Proi Proi',
                singer: 'HOYO-MiX,NIDA',
                defaultDuration: '03:58'
            },
            {
                audioId: 'miniAudio4',
                coverId: 'playerCover4',
                title: 'ä½•è€…',
                singer: 'è°­æ™¶,HOYO-MiX',
                defaultDuration: '02:26'
            },
            {
                audioId: 'miniAudio5',
                coverId: 'playerCover5',
                title: 'ç¡è•‰ä¹‹æ­Œ',
                singer: 'HOYO-MiX',
                defaultDuration: '00:17'
            },
            {
                audioId: 'miniAudio6',
                coverId: 'playerCover6',
                title: 'ä¸çœ ä¹‹å¤œ',
                singer: 'å¼ æ°,HOYO-MiX',
                defaultDuration: '02:18'
            },   
        ];
        // å…¨å±€çŠ¶æ€
        let currentSongIndex = 0;
        let isDragging = false;
        let offsetX, offsetY;
        let playState = { isExpanded: true, isPlaying: false };
        let currentAudio = document.getElementById(songList[currentSongIndex].audioId);
        // ========== æ ¸å¿ƒåŠŸèƒ½ï¼šæ­Œæ›²åˆ‡æ¢å‡½æ•° ==========
        function switchSong(newIndex) {
            if (newIndex < 0) newIndex = songList.length - 1;
            if (newIndex >= songList.length) newIndex = 0;
            currentAudio.pause();
            currentAudio.currentTime = 0;
            currentSongIndex = newIndex;
            const newSong = songList[newIndex];
            currentAudio = document.getElementById(newSong.audioId);
            playerTitle.textContent = newSong.title;
            playerSinger.textContent = newSong.singer;
            totalTimeEl.textContent = newSong.defaultDuration;
            totalTimeEl.dataset.loaded = 'false';
            progress.style.width = '0%';
            currentTimeEl.textContent = '00:00';
            document.querySelectorAll('.player-cover').forEach(cover => cover.style.display = 'none');
            document.getElementById(newSong.coverId).style.display = 'block';
            if (playState.isPlaying) {
                currentAudio.play().then(() => {
                    playBtn.textContent = 'â¸';
                    draggablePlayer.classList.add('playing');
                }).catch(handlePlayError);
            } else {
                playBtn.textContent = 'â–¶';
                draggablePlayer.classList.remove('playing');
            }
            // æ›´æ–°æ­Œæ›²åˆ—è¡¨é«˜äº®
            document.querySelectorAll('.song-list li').forEach((li, index) => {
                li.classList.toggle('active', index === newIndex);
            });
        }
        // ========== æ’­æ”¾/æš‚åœæ§åˆ¶ ==========
        playBtn.addEventListener('click', () => {
            if (currentAudio.paused) {
                currentAudio.play().then(() => {
                    playBtn.textContent = 'â¸';
                    playState.isPlaying = true;
                    draggablePlayer.classList.add('playing');
                }).catch(handlePlayError);
            } else {
                currentAudio.pause();
                playBtn.textContent = 'â–¶';
                playState.isPlaying = false;
                draggablePlayer.classList.remove('playing');
            }
        });
        // ========== ä¸Šä¸€é¦–/ä¸‹ä¸€é¦–æ§åˆ¶ ==========
        prevBtn.addEventListener('click', () => switchSong(currentSongIndex - 1));
        nextBtn.addEventListener('click', () => switchSong(currentSongIndex + 1));
        // ========== æ”¶èµ·/å±•å¼€åŠŸèƒ½ ==========
        toggleBtn.addEventListener('click', () => {
            const isHidden = playerMiniBtn.style.display === 'flex';
            if (isHidden) {
                playerMiniBtn.style.display = 'none';
                draggablePlayer.style.display = 'flex';
                toggleBtn.textContent = 'ã€<ã€‘æ”¶èµ·';
                playerContainer.style.bottom = '20px';
            } else {
                playerMiniBtn.style.display = 'flex';
                draggablePlayer.style.display = 'none';
                toggleBtn.textContent = 'å±•å¼€ã€>ã€‘';
                playerMiniBtn.textContent = playState.isPlaying ? 'â¸' : 'â–¶';
                playerContainer.style.bottom = '20px';
            }
        });
        playerMiniBtn.addEventListener('click', () => {
            playerMiniBtn.style.display = 'none';
            draggablePlayer.style.display = 'flex';
            toggleBtn.textContent = 'ã€<ã€‘æ”¶èµ·';
            
            if (playState.isPlaying && currentAudio.paused) {
                currentAudio.play().catch(handlePlayError);
            }
        });
        // ========== æ¡Œé¢ç«¯ï¼šé¼ æ ‡æ‹–åŠ¨åŠŸèƒ½ ==========
        draggablePlayer.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('player-btn') || e.target.classList.contains('volume-btn') || e.target.classList.contains('toggle-btn')) {
                return;
            }
            isDragging = true;
            const rect = playerContainer.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            draggablePlayer.style.cursor = 'grabbing';
            document.body.style.cursor = 'grabbing';
            e.preventDefault();
        });
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const newLeft = e.clientX - offsetX;
            const newTop = e.clientY - offsetY;
            const maxLeft = window.innerWidth - playerContainer.offsetWidth;
            const maxTop = window.innerHeight - playerContainer.offsetHeight;
            const finalLeft = Math.max(20, Math.min(newLeft, maxLeft - 20));
            const finalTop = Math.max(20, Math.min(newTop, maxTop - 20));
            playerContainer.style.left = `${finalLeft}px`;
            playerContainer.style.top = `${finalTop}px`;
            playerContainer.style.bottom = 'auto';
            playerContainer.style.right = 'auto';
        });
        ['mouseup', 'mouseleave', 'contextmenu'].forEach(event => {
            document.addEventListener(event, () => {
                if (isDragging) {
                    isDragging = false;
                    draggablePlayer.style.cursor = 'move';
                    document.body.style.cursor = 'default';
                }
            });
        });
        // ========== ç§»åŠ¨ç«¯ï¼šè§¦æ‘¸æ‹–åŠ¨åŠŸèƒ½ ==========
        draggablePlayer.addEventListener('touchstart', (e) => {
            const target = e.touches[0].target;
            if (target.classList.contains('player-btn') || target.classList.contains('volume-btn') || target.classList.contains('toggle-btn')) {
                return;
            }
            isDragging = true;
            const rect = playerContainer.getBoundingClientRect();
            offsetX = e.touches[0].clientX - rect.left;
            offsetY = e.touches[0].clientY - rect.top;
            draggablePlayer.style.boxShadow = '0 8px 20px rgba(0,0,0,0.5)';
            e.preventDefault();
        });
        document.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            const touch = e.touches[0];
            const newLeft = touch.clientX - offsetX;
            const newTop = touch.clientY - offsetY;
            const maxLeft = window.innerWidth - playerContainer.offsetWidth;
            const maxTop = window.innerHeight - playerContainer.offsetHeight;
            const finalLeft = Math.max(20, Math.min(newLeft, maxLeft - 20));
            const finalTop = Math.max(20, Math.min(newTop, maxTop - 20));
            playerContainer.style.left = `${finalLeft}px`;
            playerContainer.style.top = `${finalTop}px`;
            playerContainer.style.bottom = 'auto';
            playerContainer.style.right = 'auto';
            e.preventDefault();
        });
        ['touchend', 'touchcancel'].forEach(event => {
            document.addEventListener(event, () => {
                if (isDragging) {
                    isDragging = false;
                    draggablePlayer.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                }
            });
        });
        // ========== è¿›åº¦æ¡åŠŸèƒ½ï¼ˆä¿®å¤æ ¸å¿ƒï¼‰ ==========
        function updateProgress(audio) {
            // åªå¤„ç†å½“å‰æ’­æ”¾çš„éŸ³é¢‘ï¼Œé¿å…å¤šä½™æ›´æ–°
            if (audio.id !== currentAudio.id) return;
            if (isNaN(audio.duration)) return;
            
            const percent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = `${percent}%`;
            // æ›´æ–°å½“å‰æ—¶é—´
            const [cm, cs] = [Math.floor(audio.currentTime/60), Math.floor(audio.currentTime%60)];
            currentTimeEl.textContent = `${cm.toString().padStart(2, '0')}:${cs.toString().padStart(2, '0')}`;
            // åˆå§‹åŒ–æ€»æ—¶é•¿
            if (!totalTimeEl.dataset.loaded) {
                const [tm, ts] = [Math.floor(audio.duration/60), Math.floor(audio.duration%60)];
                totalTimeEl.textContent = `${tm.toString().padStart(2, '0')}:${ts.toString().padStart(2, '0')}`;
                totalTimeEl.dataset.loaded = 'true';
            }
        }
        // ç»‘å®šè¿›åº¦æ›´æ–°äº‹ä»¶ï¼ˆä¼ é€’å½“å‰éŸ³é¢‘å®ä¾‹ï¼‰
        songList.forEach(song => {
            const audio = document.getElementById(song.audioId);
            audio.addEventListener('timeupdate', () => updateProgress(audio));
            audio.addEventListener('ended', () => {
                switchSong(currentSongIndex + 1);
            });
        });
        // è¿›åº¦æ¡è·³è½¬ï¼ˆå…¼å®¹ç§»åŠ¨ç«¯è§¦æ‘¸ï¼‰
        document.getElementById('miniProgressBar').addEventListener('click', handleProgressClick);
        document.getElementById('miniProgressBar').addEventListener('touchstart', handleProgressClick);
        function handleProgressClick(e) {
            let clientX;
            if (e.type === 'touchstart') {
                clientX = e.touches[0].clientX;
            } else {
                clientX = e.clientX;
            }
            const rect = e.target.getBoundingClientRect();
            const progressPercent = (clientX - rect.left) / rect.width;
            currentAudio.currentTime = progressPercent * currentAudio.duration;
        }
        // ========== éŸ³é‡æ§åˆ¶ ==========
        volumeBtn.addEventListener('click', () => {
            let newVolume;
            if (currentAudio.volume > 0.5) newVolume = 0.3;
            else if (currentAudio.volume > 0) newVolume = 0;
            else newVolume = 0.7;
            songList.forEach(song => {
                document.getElementById(song.audioId).volume = newVolume;
            });
            volumeBtn.textContent = newVolume > 0.5 ? 'ğŸ”Š' : (newVolume > 0 ? 'ğŸ”‰' : 'ğŸ”‡');
        });
        // ========== ä½“éªŒä¼˜åŒ–ï¼šé”™è¯¯å¤„ç† ==========
        function handlePlayError() {
            alert('ç”±äºæµè§ˆå™¨é™åˆ¶ï¼Œéœ€ç‚¹å‡»æ’­æ”¾å™¨åé‡è¯•æ’­æ”¾');
            draggablePlayer.addEventListener('click', () => {
                currentAudio.play().then(() => {
                    playBtn.textContent = 'â¸';
                    playState.isPlaying = true;
                    draggablePlayer.classList.add('playing');
                });
            }, { once: true });
        }
        // ========== ä½“éªŒä¼˜åŒ–ï¼šçª—å£ç„¦ç‚¹æ¢å¤æ’­æ”¾ ==========
        window.addEventListener('focus', () => {
            if (playState.isPlaying && currentAudio.paused) {
                currentAudio.play().catch(() => {});
            }
        });
        // ========== æ­Œæ›²åˆ—è¡¨åŠŸèƒ½ï¼ˆæ–°å¢æ ¸å¿ƒï¼‰ ==========
        // åˆå§‹åŒ–æ­Œæ›²åˆ—è¡¨
        function initSongList() {
            songListEl.innerHTML = '';
            songList.forEach((song, index) => {
                const li = document.createElement('li');
                li.classList.toggle('active', index === currentSongIndex);
                li.innerHTML = `${index + 1}. ${song.title} - ${song.singer}`;
                
                // æ¡Œé¢ç«¯ç‚¹å‡»äº‹ä»¶
                li.addEventListener('click', () => {
                    switchSong(index);
                    songListContainer.classList.remove('show');
                });
                
                // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
                li.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    switchSong(index);
                    songListContainer.classList.remove('show');
                });
                
                songListEl.appendChild(li);
            });
        }
        // æ­Œæ›²åˆ—è¡¨æ˜¾ç¤º/éšè—åˆ‡æ¢
        listToggleBtn.addEventListener('click', () => {
            songListContainer.classList.toggle('show');
        });
        // ========== åˆå§‹åŒ– ==========
        window.addEventListener('load', () => {
            totalTimeEl.textContent = songList[currentSongIndex].defaultDuration;
            initSongList(); // åˆå§‹åŒ–æ­Œæ›²åˆ—è¡¨
        });
        // ========== ç›‘å¬ä¸»é¡µæ¢å¤æ’­æ”¾çŠ¶æ€ ==========
        window.addEventListener('message', (e) => {
            if (e.data.type === 'RESTORE_PLAY_STATE' && playState.isPlaying) {
                currentAudio.play().catch(() => {});
            }
        });
    </script>
</body>
            </html>
