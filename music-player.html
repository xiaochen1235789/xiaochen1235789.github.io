<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å±å¯æ‹–åŠ¨æ’­æ”¾å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body {
            background: transparent;
            padding: 0; margin: 0;
            height: 100%;
            overflow: hidden;
        }
        /* æ’­æ”¾å™¨å®¹å™¨ï¼šé¢„ç•™è¿›åº¦æ¡ç©ºé—´ */
        .player-container {
            position: fixed;
            bottom: 0;
            left: 20px;
            z-index: 99999;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-top: 10px; /* ä¸ºè¿›åº¦æ¡ç•™é¡¶éƒ¨ç©ºé—´ */
        }
        .player-mini-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1e3a2f;
            border: 1px solid #3d725f;
            color: #81c784;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: none;
        }
        /* æ’­æ”¾å™¨ä¸»ä½“ï¼šç›¸å¯¹å®šä½ï¼Œç¡®ä¿è¿›åº¦æ¡å¯¹é½ */
        .mini-music-player {
            width: 100%;
            max-width: 340px; /* åŠ å®½é€‚é…è¿›åº¦æ¡ */
            height: 60px;
            min-width: 300px;
            background: #1e3a2f;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 8px;
            border: 1px solid #3d725f;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: move;
            user-select: none;
            -webkit-user-drag: none;
            position: relative; /* è¿›åº¦æ¡ç›¸å¯¹æ­¤å…ƒç´ å®šä½ */
        }
        .player-cover {
            width: 44px;
            height: 44px;
            border-radius: 4px;
            background: #2d5243;
            overflow: hidden;
            flex-shrink: 0;
        }
        .player-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        .player-info {
            flex: 0 0 130px; /* åŠ å®½æ–‡æœ¬åŒºåŸŸï¼Œé¿å…æˆªæ–­ */
            flex-shrink: 0;
            pointer-events: none;
        }
        .player-title {
            font-size: 0.85rem;
            color: #81c784;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .player-singer {
            font-size: 0.7rem;
            color: #99aabb;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .player-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .player-btn {
            background: transparent;
            border: none;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.9rem;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        .play-main-btn {
            background: #81c784;
            color: #121212;
            font-weight: bold;
        }
        .player-volume {
            flex: 0 0 28px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        .volume-btn {
            background: transparent;
            border: none;
            color: #99aabb;
            cursor: pointer;
            font-size: 0.8rem;
            z-index: 1;
        }
        .toggle-btn {
            background: transparent;
            border: none;
            color: #99aabb;
            cursor: pointer;
            font-size: 0.9rem;
            flex-shrink: 0;
            z-index: 1;
        }
        /* è¿›åº¦æ¡ï¼šå®Œæ•´æ˜¾ç¤º+è‡ªé€‚åº”é«˜åº¦ */
        .player-progress {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            width: 100%;
            padding: 4px 2%; /* å·¦å³ç•™è¾¹ï¼Œé¿å…è¶…å‡º */
            background: #1e3a2f;
            border-radius: 4px 4px 0 0;
            border-bottom: 1px solid #3d725f;
            box-sizing: border-box;
            min-height: 24px; /* ç¡®ä¿æ—¶é—´æ–‡å­—ä¸æŒ¤å‹ */
        }
        .mini-music-player:hover .player-progress {
            display: block;
        }
        .progress-bar-mini {
            width: 100%;
            height: 3px;
            background: #2d5243;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }
        .progress-mini {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 30%;
            background: #81c784;
            border-radius: 2px;
        }
        .time-mini {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #99aabb;
            margin-top: 2px;
            width: 100%;
        }
        @media (max-width: 768px) {
            .mini-music-player {
                width: 300px;
                gap: 6px;
            }
            .player-info {
                flex: 0 0 110px;
            }
        }
    </style>
</head>
<body>
    <div class="player-container" id="playerContainer">
        <button class="player-mini-btn" id="playerMiniBtn">â–¶</button>
        <div class="mini-music-player" id="draggablePlayer">
            <div class="player-cover">
                <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/4e9fac6fa0c64944b8e3ce67243a0029.jpeg~tplv-a9rns2rl98-24:720:720.jpeg" alt="ä¸“è¾‘å°é¢">
            </div>
            <div class="player-info">
                <div class="player-title">æ˜”æ¶Ÿ</div>
                <div class="player-singer">å¼ éŸ¶æ¶µã€HOYO-MiX</div>
            </div>
            <div class="player-controls">
                <button class="player-btn" id="miniPrevBtn">â®</button>
                <button class="player-btn play-main-btn" id="miniPlayBtn">â–¶</button>
                <button class="player-btn" id="miniNextBtn">â¯</button>
            </div>
            <div class="player-volume">
                <button class="volume-btn" id="volumeBtn">ğŸ”Š</button>
            </div>
            <button class="toggle-btn" id="toggleBtn">ã€<ã€‘æ”¶èµ·</button>
            <div class="player-progress">
                <div class="progress-bar-mini" id="miniProgressBar">
                    <div class="progress-mini" id="miniProgress"></div>
                </div>
                <div class="time-mini">
                    <span class="current-time-mini" id="currentTime">00:00</span>
                    <span class="total-time-mini" id="totalTime">04:29</span>
                </div>
            </div>
        </div>
        <audio id="miniAudioPlayer" preload="auto" playsinline>
            <source src="https://xiaochen1235789.github.io/music/æ˜”æ¶Ÿ.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
         </audio>
    </div>
    <script>
        // å…ƒç´ åˆå§‹åŒ–
        const playerContainer = document.getElementById('playerContainer');
        const draggablePlayer = document.getElementById('draggablePlayer');
        const audio = document.getElementById('miniAudioPlayer');
        const playBtn = document.getElementById('miniPlayBtn');
        const toggleBtn = document.getElementById('toggleBtn');
        const playerMiniBtn = document.getElementById('playerMiniBtn');
        const progress = document.getElementById('miniProgress');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const volumeBtn = document.getElementById('volumeBtn');

        // çŠ¶æ€å˜é‡
        let isDragging = false;
        let offsetX, offsetY;
        let playState = { isExpanded: true, isPlaying: false };

        // ========== å…¨å±æ‹–åŠ¨åŠŸèƒ½ ==========
        draggablePlayer.addEventListener('mousedown', (e) => {
            // ç‚¹å‡»æŒ‰é’®æ—¶ä¸è§¦å‘æ‹–åŠ¨
            if (e.target.classList.contains('player-btn') || e.target.classList.contains('volume-btn') || e.target.classList.contains('toggle-btn')) {
                return;
            }
            isDragging = true;
            const rect = playerContainer.getBoundingClientRect();
            // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºæ’­æ”¾å™¨çš„åç§»é‡
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            draggablePlayer.style.cursor = 'grabbing';
            document.body.style.cursor = 'grabbing';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            // è®¡ç®—æ–°ä½ç½®ï¼Œé™åˆ¶åœ¨å±å¹•å†…
            const newLeft = e.clientX - offsetX;
            const newTop = e.clientY - offsetY;
            const maxLeft = window.innerWidth - playerContainer.offsetWidth;
            const maxTop = window.innerHeight - playerContainer.offsetHeight;
            const finalLeft = Math.max(0, Math.min(newLeft, maxLeft));
            const finalTop = Math.max(0, Math.min(newTop, maxTop));
            // æ›´æ–°æ’­æ”¾å™¨ä½ç½®
            playerContainer.style.left = `${finalLeft}px`;
            playerContainer.style.top = `${finalTop}px`;
            playerContainer.style.bottom = 'auto';
            playerContainer.style.right = 'auto';
        });

        // ç»“æŸæ‹–åŠ¨
        ['mouseup', 'mouseleave', 'contextmenu'].forEach(event => {
            document.addEventListener(event, () => {
                if (isDragging) {
                    isDragging = false;
                    draggablePlayer.style.cursor = 'move';
                    document.body.style.cursor = 'default';
                }
            });
        });

        // ========== æ’­æ”¾/æš‚åœæ§åˆ¶ ==========
        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play().then(() => {
                    playBtn.textContent = 'â¸';
                    playState.isPlaying = true;
                }).catch(() => {
                    // è‡ªåŠ¨æ’­æ”¾å¤±è´¥æ—¶ï¼Œç‚¹å‡»æ’­æ”¾å™¨é‡è¯•
                    draggablePlayer.addEventListener('click', () => {
                        audio.play();
                        playBtn.textContent = 'â¸';
                        playState.isPlaying = true;
                    }, { once: true });
                });
            } else {
                audio.pause();
                playBtn.textContent = 'â–¶';
                playState.isPlaying = false;
            }
        });

        // ========== æ”¶èµ·/å±•å¼€åŠŸèƒ½ ==========
        toggleBtn.addEventListener('click', () => {
            const isHidden = playerMiniBtn.style.display === 'flex';
            if (isHidden) {
                // å±•å¼€
                playerMiniBtn.style.display = 'none';
                draggablePlayer.style.display = 'flex';
                toggleBtn.textContent = 'ã€<ã€‘æ”¶èµ·';
            } else {
                // æ”¶èµ·
                playerMiniBtn.style.display = 'flex';
                draggablePlayer.style.display = 'none';
                toggleBtn.textContent = 'å±•å¼€ã€>ã€‘';
                playerMiniBtn.textContent = audio.paused ? 'â–¶' : 'â¸';
            }
        });

        playerMiniBtn.addEventListener('click', () => {
            // ç‚¹å‡»æ”¶èµ·æŒ‰é’®åå±•å¼€
            playerMiniBtn.style.display = 'none';
            draggablePlayer.style.display = 'flex';
            toggleBtn.textContent = 'ã€<ã€‘æ”¶èµ·';
            if (!audio.paused) audio.play();
        });

        // ========== è¿›åº¦æ¡æ›´æ–° ==========
        audio.addEventListener('timeupdate', () => {
            if (isNaN(audio.duration)) return;
            // æ›´æ–°è¿›åº¦æ¡å®½åº¦
            const percent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = `${percent}%`;
            // æ›´æ–°å½“å‰æ—¶é—´
            const [cm, cs] = [Math.floor(audio.currentTime/60), Math.floor(audio.currentTime%60)];
            currentTimeEl.textContent = `${cm.toString().padStart(2, '0')}:${cs.toString().padStart(2, '0')}`;
            // åˆå§‹åŒ–æ€»æ—¶é•¿
            if (!totalTimeEl.dataset.loaded) {
                const [tm, ts] = [Math.floor(audio.duration/60), Math.floor(audio.duration%60)];
                totalTimeEl.textContent = `${tm.toString().padStart(2, '0')}:${ts.toString().padStart(2, '0')}`;
                totalTimeEl.dataset.loaded = 'true';
            }
        });

        // ========== è¿›åº¦æ¡è·³è½¬ ==========
        document.getElementById('miniProgressBar').addEventListener('click', (e) => {
            const progressPercent = e.offsetX / e.target.clientWidth;
            audio.currentTime = progressPercent * audio.duration;
        });

        // ========== éŸ³é‡æ§åˆ¶ ==========
        volumeBtn.addEventListener('click', () => {
            audio.volume = audio.volume > 0.5 ? 0.3 : (audio.volume > 0 ? 0 : 0.7);
            volumeBtn.textContent = audio.volume > 0.5 ? 'ğŸ”Š' : (audio.volume > 0 ? 'ğŸ”‰' : 'ğŸ”‡');
        });

        // ========== ç›‘å¬ä¸»é¡µæ¢å¤æ’­æ”¾çŠ¶æ€ ==========
        window.addEventListener('message', (e) => {
            if (e.data.type === 'RESTORE_PLAY_STATE' && playState.isPlaying) {
                audio.play().catch(() => {});
            }
        });
    </script>
</body>
</html>