
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å…­å“¥è£è€€ - ç»„å»ºå°é˜Ÿ</title>
    <link rel="icon" href="https://xiaochen1235789.github.io/images/wangzhantupian.png" type="image/png">
    <!-- å¼•å…¥æ¸¸æˆæ•°æ® -->
    <script src="game-data.js"></script>
    <style>
        :root {
            --hsr-bg: #0a0a14;
            --hsr-surface: #151525;
            --hsr-card: #1e1e2e;
            --hsr-primary: #00d4ff;
            --hsr-primary-dark: #0088cc;
            --hsr-primary-light: #66e5ff;
            --hsr-text: #ffffff;
            --hsr-subtext: #a0b4c6;
            --hsr-danger: #ff4757;
            --hsr-warning: #ff9f43;
            --hsr-success: #1dd1a1;
            --hsr-energy: #4488ff;
            --hsr-hp: #ff6b81;
            --hsr-glass: rgba(255, 255, 255, 0.05);
            --hsr-glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'HYWenHei-85W', 'Microsoft YaHei', sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--hsr-bg);
            color: var(--hsr-text);
            position: fixed;
        }

        /* èƒŒæ™¯ */
        .selection-container {
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 10%, #1a1a3a 0%, transparent 40%),
                radial-gradient(circle at 80% 90%, #0f1a2e 0%, transparent 40%),
                var(--hsr-bg);
            padding: 20px;
            overflow: auto;
            position: relative;
        }

        /* è¿”å›æŒ‰é’® */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: var(--hsr-glass);
            border: 1px solid var(--hsr-glass-border);
            border-radius: 10px;
            color: var(--hsr-text);
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            border-color: var(--hsr-primary);
            background: rgba(0, 212, 255, 0.1);
            transform: translateX(-5px);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        /* æ ‡é¢˜ */
        .page-title {
            text-align: center;
            margin: 40px 0 30px;
            padding-top: 20px;
        }

        .page-title h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00d4ff, #66e5ff, #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        .page-title p {
            color: var(--hsr-subtext);
            opacity: 0.8;
            font-size: 1.1rem;
        }

        /* é˜Ÿä¼æç¤º */
        .team-info {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .team-info h3 {
            color: var(--hsr-primary);
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .team-count {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--hsr-glass);
            border-radius: 20px;
            margin-top: 10px;
            border: 1px solid var(--hsr-glass-border);
        }

        .team-count .count {
            font-weight: bold;
            color: var(--hsr-primary);
            font-size: 1.2rem;
        }

        /* å·²é€‰è§’è‰²åŒºåŸŸ */
        .selected-area {
            max-width: 1000px;
            margin: 0 auto 40px;
            padding: 25px;
            background: var(--hsr-glass);
            border-radius: 20px;
            border: 1px solid var(--hsr-glass-border);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .selected-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--hsr-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selected-characters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            min-height: 150px;
        }

        .empty-slot {
            background: rgba(255, 255, 255, 0.02);
            border: 2px dashed var(--hsr-glass-border);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            color: var(--hsr-subtext);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .empty-slot:hover {
            background: rgba(0, 212, 255, 0.05);
            border-color: var(--hsr-primary);
            transform: translateY(-5px);
        }

        .empty-slot .slot-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .character-slot {
            background: var(--hsr-surface);
            border: 2px solid var(--hsr-glass-border);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            position: relative;
        }

        .character-slot:hover {
            border-color: var(--hsr-primary);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
            transform: translateY(-5px);
        }

        .character-slot.selected {
            border-color: var(--hsr-success);
            box-shadow: 0 10px 30px rgba(29, 209, 161, 0.3);
        }

        .slot-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--hsr-primary), var(--hsr-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .slot-info {
            flex: 1;
        }

        .slot-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--hsr-text);
        }

        .slot-path {
            font-size: 0.85rem;
            color: var(--hsr-primary);
            background: rgba(0, 212, 255, 0.15);
            padding: 2px 10px;
            border-radius: 12px;
            display: inline-block;
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            background: var(--hsr-danger);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0;
            transition: all 0.3s;
        }

        .character-slot:hover .remove-btn {
            opacity: 1;
        }

        /* è§’è‰²é€‰æ‹©åŒºåŸŸ */
        .character-select {
            max-width: 1000px;
            margin: 0 auto;
        }

        .character-select h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--hsr-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .character-card {
            background: var(--hsr-surface);
            border: 2px solid var(--hsr-glass-border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .character-card:hover::before {
            left: 100%;
        }

        .character-card:hover {
            border-color: var(--hsr-primary);
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.2);
        }

        .character-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        .character-card.disabled:hover {
            transform: none;
            border-color: var(--hsr-glass-border);
            box-shadow: none;
        }

        .character-card.selected {
            border-color: var(--hsr-success);
            background: rgba(29, 209, 161, 0.05);
        }

        .character-card.selected .card-status {
            background: var(--hsr-success);
            color: white;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--hsr-primary), var(--hsr-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .card-info {
            flex: 1;
        }

        .card-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--hsr-text);
        }

        .card-path {
            font-size: 0.85rem;
            color: var(--hsr-primary);
            background: rgba(0, 212, 255, 0.15);
            padding: 2px 10px;
            border-radius: 12px;
            display: inline-block;
        }

        .card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--hsr-glass);
            border-radius: 12px;
            border: 1px solid var(--hsr-glass-border);
        }

        .card-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }

        .stat-icon {
            color: var(--hsr-primary);
            font-size: 0.9rem;
        }

        .stat-value {
            color: var(--hsr-text);
            font-weight: 600;
        }

        .card-skills {
            margin-top: 10px;
        }

        .skill-tag {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--hsr-subtext);
            margin-right: 6px;
            margin-bottom: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            background: rgba(29, 209, 161, 0.2);
            color: var(--hsr-success);
            border-radius: 10px;
            font-size: 0.75rem;
            border: 1px solid rgba(29, 209, 161, 0.3);
        }

        /* è¡ŒåŠ¨æŒ‰é’® */
        .action-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 50;
            padding: 0 20px;
            width: 100%;
            max-width: 1000px;
            justify-content: center;
        }

        .action-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .reset-btn {
            background: var(--hsr-glass);
            border: 2px solid var(--hsr-glass-border);
            color: var(--hsr-text);
        }

        .reset-btn:hover:not(:disabled) {
            background: rgba(255, 71, 87, 0.1);
            border-color: var(--hsr-danger);
            color: var(--hsr-danger);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 71, 87, 0.2);
        }

        .start-btn {
            background: linear-gradient(135deg, var(--hsr-primary), var(--hsr-primary-dark));
            border: 2px solid transparent;
            color: white;
        }

        .start-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--hsr-primary-light), var(--hsr-primary));
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.4);
        }

        /* æç¤ºä¿¡æ¯ */
        .message-box {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid var(--hsr-glass-border);
            border-radius: 12px;
            padding: 15px 25px;
            color: var(--hsr-warning);
            font-size: 0.95rem;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideUp 0.3s ease;
            z-index: 100;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* è§’è‰²è¯¦æƒ…é¢„è§ˆ */
        .character-preview {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            background: var(--hsr-surface);
            border: 1px solid var(--hsr-glass-border);
            border-radius: 20px;
            padding: 30px;
            z-index: 1000;
            backdrop-filter: blur(30px);
            display: none;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: panelFadeIn 0.3s ease;
        }

        .character-preview.active {
            display: flex;
        }

        .preview-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .preview-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--hsr-primary), var(--hsr-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .preview-info h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .preview-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preview-tag {
            padding: 4px 12px;
            background: rgba(0, 212, 255, 0.15);
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--hsr-primary);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .preview-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
            background: var(--hsr-glass);
            border-radius: 15px;
        }

        .preview-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }

        .stat-label {
            color: var(--hsr-subtext);
        }

        .stat-value {
            color: var(--hsr-text);
            font-weight: 600;
        }

        .preview-skills {
            padding: 20px;
            background: var(--hsr-glass);
            border-radius: 15px;
        }

        .preview-skills h4 {
            margin-bottom: 15px;
            color: var(--hsr-primary);
            font-size: 1.1rem;
        }

        .preview-skill {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--hsr-glass-border);
            font-size: 0.9rem;
        }

        .preview-skill:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .skill-name {
            font-weight: 600;
            color: var(--hsr-text);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .skill-desc {
            color: var(--hsr-subtext);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .preview-actions {
            display: flex;
            gap: 15px;
        }

        .preview-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .preview-cancel {
            background: var(--hsr-glass);
            color: var(--hsr-text);
            border: 1px solid var(--hsr-glass-border);
        }

        .preview-select {
            background: linear-gradient(135deg, var(--hsr-primary), var(--hsr-primary-dark));
            color: white;
            border: 1px solid transparent;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .page-title h1 {
                font-size: 2rem;
            }
            
            .character-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .selected-characters {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
                padding: 0 20px;
            }
            
            .action-btn {
                min-width: auto;
            }
            
            .character-card {
                padding: 15px;
            }
            
            .card-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .card-info {
                text-align: center;
            }
            
            .card-stats {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .selected-characters {
                grid-template-columns: 1fr;
            }
            
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-title {
                margin: 20px 0;
            }
            
            .selection-container {
                padding: 10px;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .selection-container::-webkit-scrollbar {
            width: 8px;
        }

        .selection-container::-webkit-scrollbar-track {
            background: var(--hsr-glass);
            border-radius: 4px;
        }

        .selection-container::-webkit-scrollbar-thumb {
            background: var(--hsr-primary);
            border-radius: 4px;
        }

        .selection-container::-webkit-scrollbar-thumb:hover {
            background: var(--hsr-primary-light);
        }
    </style>
</head>
<body>
    <a href="https://xiaochen1235789.github.io/ai sister/index.html" class="back-button">
        â† è¿”å›ä¸»èœå•
    </a>
    
    <div class="selection-container">
        <div class="page-title">
            <h1>ç»„å»ºä½ çš„å°é˜Ÿ</h1>
            <p>é€‰æ‹©4åè§’è‰²ç»„æˆä½ çš„æˆ˜æ–—é˜Ÿä¼</p>
        </div>
        
        <div class="team-info">
            <h3>é˜Ÿä¼é…ç½®æç¤º</h3>
            <p>å»ºè®®é˜Ÿä¼åŒ…å«ï¼š1ä¸ªå¦å…‹ã€1ä¸ªæ²»ç–—ã€2ä¸ªè¾“å‡º</p>
            <div class="team-count">
                <span>å·²é€‰æ‹©ï¼š</span>
                <span class="count" id="selectedCount">0</span>
                <span>/4</span>
            </div>
        </div>
        
        <!-- å·²é€‰è§’è‰²åŒºåŸŸ -->
        <div class="selected-area">
            <div class="selected-title">
                <span>ğŸ›¡ï¸</span>
                <span>ä½ çš„é˜Ÿä¼</span>
            </div>
            <div class="selected-characters" id="selectedCharacters">
                <!-- åŠ¨æ€ç”Ÿæˆç©ºä½ -->
            </div>
        </div>
        
        <!-- è§’è‰²é€‰æ‹©åŒºåŸŸ -->
        <div class="character-select">
            <h3>
                <span>ğŸŒŸ</span>
                <span>å¯ç”¨è§’è‰²</span>
            </h3>
            <div class="character-grid" id="characterGrid">
                <!-- åŠ¨æ€ç”Ÿæˆè§’è‰²å¡ -->
            </div>
        </div>
        
        <!-- è¡ŒåŠ¨æŒ‰é’® -->
        <div class="action-buttons">
            <button class="action-btn reset-btn" onclick="resetSelection()">
                <span>ğŸ”„</span>
                <span>é‡ç½®é€‰æ‹©</span>
            </button>
            <button class="action-btn start-btn" id="startBtn" onclick="startBattle()" disabled>
                <span>ğŸš€</span>
                <span>å¼€å§‹æˆ˜æ–—</span>
            </button>
        </div>
        
        <!-- æç¤ºä¿¡æ¯ -->
        <div class="message-box" id="messageBox"></div>
    </div>
    
    <!-- è§’è‰²è¯¦æƒ…é¢„è§ˆ -->
    <div class="character-preview" id="characterPreview">
        <div class="preview-header">
            <div class="preview-avatar" id="previewAvatar">ğŸš€</div>
            <div class="preview-info">
                <h3 id="previewName">è§’è‰²å</h3>
                <div class="preview-tags">
                    <span class="preview-tag" id="previewPath">å‘½é€”</span>
                    <span class="preview-tag" id="previewElement">å±æ€§</span>
                    <span class="preview-tag" id="previewRarity">ç¨€æœ‰åº¦</span>
                </div>
            </div>
        </div>
        
        <div class="preview-stats">
            <div class="preview-stat">
                <span class="stat-label">ç”Ÿå‘½å€¼</span>
                <span class="stat-value" id="previewHP">1500</span>
            </div>
            <div class="preview-stat">
                <span class="stat-label">æ”»å‡»åŠ›</span>
                <span class="stat-value" id="previewAttack">120</span>
            </div>
            <div class="preview-stat">
                <span class="stat-label">é˜²å¾¡åŠ›</span>
                <span class="stat-value" id="previewDefense">80</span>
            </div>
            <div class="preview-stat">
                <span class="stat-label">é€Ÿåº¦</span>
                <span class="stat-value" id="previewSpeed">100</span>
            </div>
            <div class="preview-stat">
                <span class="stat-label">æš´å‡»ç‡</span>
                <span class="stat-value" id="previewCritRate">0%</span>
            </div>
            <div class="preview-stat">
                <span class="stat-label">æš´å‡»ä¼¤å®³</span>
                <span class="stat-value" id="previewCritDamage">0%</span>
            </div>
        </div>
        
        <div class="preview-skills">
            <h4>æŠ€èƒ½</h4>
            <div class="preview-skill" id="previewSkill1"></div>
            <div class="preview-skill" id="previewSkill2"></div>
            <div class="preview-skill" id="previewSkill3"></div>
            <div class="preview-skill" id="previewSkill4"></div>
        </div>
        
        <div class="preview-actions">
            <button class="preview-btn preview-cancel" onclick="closePreview()">
                å–æ¶ˆ
            </button>
            <button class="preview-btn preview-select" onclick="selectFromPreview()">
                åŠ å…¥é˜Ÿä¼
            </button>
        </div>
    </div>
<script>
    // ä»æ¸¸æˆæ•°æ®è·å–è§’è‰²
    function getGameCharacters() {
        if (typeof GameData === 'undefined' || !GameData.characters) {
            console.warn('æ¸¸æˆæ•°æ®æœªåŠ è½½ï¼Œä½¿ç”¨å¤‡ç”¨æ•°æ®');
            return getFallbackCharacters();
        }
        
        // ä¸ºæ¯ä¸ªè§’è‰²åˆ†é…å¯¹åº”çš„è¡¨æƒ…ç¬¦å·
        const characterEmojis = {
            'luguan': 'ğŸ¦Œ',
            'fire_guard': 'ğŸ›¡ï¸',
            'quantum_mage': 'ğŸŒŒ',
            'lightning_healer': 'âš¡',
            'ice_assassin': 'â„ï¸',
            'physical_warrior': 'âš”ï¸'
        };
        
        return GameData.characters.map((char, index) => ({
            id: index,
            gameId: char.id,
            name: char.name,
            // ä½¿ç”¨é¢„è®¾çš„è¡¨æƒ…ç¬¦å·ï¼Œè€Œä¸æ˜¯HTMLé“¾æ¥
            avatar: characterEmojis[char.id] || 'â­',
            path: char.path,
            element: getElementName(char.element || 'wind'),
            rarity: char.rarity === 5 ? 'â­â­â­â­â­' : 'â­â­â­â­',
            hp: char.maxHp,
            attack: char.attack,
            defense: char.defense,
            speed: char.speed,
            critRate: Math.round((char.critRate || 0) * 100) + '%',
            critDamage: Math.round((char.critDamage || 1.5) * 100) + '%',
            skills: char.skills.map(skill => ({
                name: skill.name,
                icon: skill.icon,
                description: skill.description
            })),
            description: getCharacterDescription(char)
        }));
    }

    // è·å–å…ƒç´ åç§°
    function getElementName(element) {
        const elements = {
            'wind': 'ğŸ’¨ é£',
            'fire': 'ğŸ”¥ ç«',
            'ice': 'â„ï¸ å†°',
            'lightning': 'âš¡ é›·',
            'quantum': 'ğŸŒŒ é‡å­',
            'physical': 'ğŸ’ª ç‰©ç†',
            'imaginary': 'âœ¨ è™šæ•°'
        };
        return elements[element] || 'ğŸ’« æœªçŸ¥';
    }

    // è·å–è§’è‰²æè¿°
    function getCharacterDescription(character) {
        if (character.path === 'å·¡çŒ') return 'é«˜é€Ÿå•ä½“è¾“å‡º';
        if (character.path === 'å­˜æŠ¤') return 'ä¼˜ç§€çš„é˜²å¾¡è€…';
        if (character.path === 'ä¸°é¥¶') return 'æ²»ç–—ä¸æ”¯æ´';
        if (character.path === 'æ™ºè¯†') return 'èŒƒå›´ä¼¤å®³ä¸“å®¶';
        if (character.path === 'è™šæ— ') return 'æ§åˆ¶ä¸å‰Šå¼±';
        if (character.path === 'æ¯ç­') return 'å‡è¡¡çš„è¾“å‡ºè€…';
        return 'å†’é™©çš„æ—…è€…';
    }

    // å¤‡ç”¨è§’è‰²æ•°æ®ï¼ˆå¦‚æœæ¸¸æˆæ•°æ®æœªåŠ è½½ï¼‰
    function getFallbackCharacters() {
        return [
            {
                id: 0,
                gameId: 'luguan',
                name: "é¹¿ç®¡",
                avatar: "ğŸ¦Œ",
                path: "å·¡çŒ",
                element: "ğŸ’¨ é£",
                rarity: "â­â­â­â­â­",
                hp: 9999,
                attack: 2900,
                defense: 800,
                speed: 140,
                critRate: "80%",
                critDamage: "175%",
                skills: [
                    {name: "è¿…é£æ–©", icon: "âš”ï¸", description: "å•ä½“é£å±æ€§ä¼¤å®³110%"},
                    {name: "é£ä¹‹æŒ‘è¡…", icon: "ğŸŒ€", description: "å•ä½“ä¼¤å®³ï¼Œé™ä½ç›®æ ‡é˜²å¾¡"},
                    {name: "ç‹‚é£ç»ˆç»“", icon: "ğŸ’¥", description: "å•ä½“é«˜ä¼¤å®³ï¼Œå¯¹è´Ÿé¢ç›®æ ‡ä¼¤å®³æé«˜"},
                    {name: "é˜²å¾¡", icon: "ğŸ›¡ï¸", description: "å‡å°‘ä¸‹æ¬¡å—åˆ°çš„ä¼¤å®³"}
                ],
                description: "é«˜é€Ÿå•ä½“è¾“å‡º"
            },
            {
                id: 1,
                gameId: 'fire_guard',
                name: "ç‚ç›¾æŠ¤å«",
                avatar: "ğŸ›¡ï¸",
                path: "å­˜æŠ¤",
                element: "ğŸ”¥ ç«",
                rarity: "â­â­â­â­",
                hp: 15000,
                attack: 1800,
                defense: 1600,
                speed: 100,
                critRate: "5%",
                critDamage: "150%",
                skills: [
                    {name: "çƒˆç„°ç›¾å‡»", icon: "ğŸ”¥", description: "å•ä½“ç«å±æ€§ä¼¤å®³ï¼Œé™„å¸¦å˜²è®½"},
                    {name: "ç‚½çƒ­å±éšœ", icon: "ğŸ›¡ï¸", description: "æä¾›æŠ¤ç›¾"},
                    {name: "ç†”å²©çˆ†å‘", icon: "ğŸŒ‹", description: "ç¾¤ä½“ç«å±æ€§ä¼¤å®³ï¼Œå˜²è®½æ‰€æœ‰æ•Œäºº"},
                    {name: "åšå®ˆé˜µåœ°", icon: "ğŸ°", description: "å¤§å¹…æå‡é˜²å¾¡åŠ›"}
                ],
                description: "ä¼˜ç§€çš„é˜²å¾¡è€…"
            },
            {
                id: 2,
                gameId: 'quantum_mage',
                name: "é‡å­æœ¯å£«",
                avatar: "ğŸŒŒ",
                path: "æ™ºè¯†",
                element: "ğŸŒŒ é‡å­",
                rarity: "â­â­â­â­â­",
                hp: 7500,
                attack: 3200,
                defense: 600,
                speed: 110,
                critRate: "30%",
                critDamage: "180%",
                skills: [
                    {name: "é‡å­é£å¼¹", icon: "âš›ï¸", description: "å•ä½“é‡å­å±æ€§ä¼¤å®³"},
                    {name: "ç»´åº¦åç¼©", icon: "ğŸŒ€", description: "å¯¹éšæœºç›®æ ‡è¿›è¡Œ3æ¬¡é‡å­æ”»å‡»"},
                    {name: "é»‘æ´å¥‡ç‚¹", icon: "ğŸ•³ï¸", description: "ç¾¤ä½“é‡å­å±æ€§ä¼¤å®³ï¼Œæ¦‚ç‡ç¦é”¢"},
                    {name: "é‡å­æŠ¤ç›¾", icon: "âœ¨", description: "ç”Ÿæˆé‡å­æŠ¤ç›¾å¸æ”¶ä¼¤å®³"}
                ],
                description: "èŒƒå›´ä¼¤å®³ä¸“å®¶"
            },
            {
                id: 3,
                gameId: 'lightning_healer',
                name: "é›·é¸£åŒ»è€…",
                avatar: "âš¡",
                path: "ä¸°é¥¶",
                element: "âš¡ é›·",
                rarity: "â­â­â­â­",
                hp: 9000,
                attack: 1500,
                defense: 900,
                speed: 120,
                critRate: "10%",
                critDamage: "150%",
                skills: [
                    {name: "ç”µç–—ä¹‹è§¦", icon: "âš¡", description: "å•ä½“é›·å±æ€§ä¼¤å®³ï¼Œé™„å¸¦å¾®é‡æ²»ç–—"},
                    {name: "å¤è‹é›·é›¨", icon: "ğŸŒ§ï¸", description: "æ²»ç–—å…¨ä½“é˜Ÿå‹"},
                    {name: "å¤©é›·å‡€åŒ–", icon: "â˜‡", description: "ç¾¤ä½“é›·å±æ€§ä¼¤å®³ï¼Œæ¸…é™¤è´Ÿé¢çŠ¶æ€"},
                    {name: "é™ç”µå±éšœ", icon: "âš¡", description: "ç”Ÿæˆé™ç”µå±éšœå‡å°‘ä¼¤å®³"}
                ],
                description: "æ²»ç–—ä¸æ”¯æ´"
            },
            {
                id: 4,
                gameId: 'ice_assassin',
                name: "å¯’å†°åˆºå®¢",
                avatar: "â„ï¸",
                path: "å·¡çŒ",
                element: "â„ï¸ å†°",
                rarity: "â­â­â­â­",
                hp: 8500,
                attack: 2600,
                defense: 700,
                speed: 150,
                critRate: "40%",
                critDamage: "190%",
                skills: [
                    {name: "å¯’å†°åˆº", icon: "â„ï¸", description: "å•ä½“å†°å±æ€§ä¼¤å®³ï¼Œæ¦‚ç‡å†»ç»“"},
                    {name: "éœœåè¿å‡»", icon: "ğŸ¥¶", description: "å•ä½“å†°å±æ€§ä¼¤å®³ï¼Œè¿ç»­æ”»å‡»2æ¬¡"},
                    {name: "ç»å¯¹é›¶åº¦", icon: "ğŸ§Š", description: "å•ä½“è¶…é«˜å†°å±æ€§ä¼¤å®³ï¼Œå¿…ä¸­å†»ç»“"},
                    {name: "å†°é•œåå°„", icon: "ğŸª", description: "è¿›å…¥éšèº«çŠ¶æ€"}
                ],
                description: "é«˜é€Ÿå•ä½“è¾“å‡º"
            },
            {
                id: 5,
                gameId: 'physical_warrior',
                name: "é’¢é“æˆ˜å£«",
                avatar: "âš”ï¸",
                path: "æ¯ç­",
                element: "ğŸ’ª ç‰©ç†",
                rarity: "â­â­â­â­",
                hp: 12000,
                attack: 2200,
                defense: 1200,
                speed: 105,
                critRate: "20%",
                critDamage: "160%",
                skills: [
                    {name: "é‡é”¤çŒ›å‡»", icon: "ğŸ”¨", description: "å•ä½“ç‰©ç†ä¼¤å®³ï¼Œé™„å¸¦ç ´é˜²"},
                    {name: "æ—‹é£æ–©", icon: "ğŸŒ€", description: "ç¾¤ä½“ç‰©ç†ä¼¤å®³"},
                    {name: "ç‹‚æš´å†²é”‹", icon: "ğŸ’¥", description: "å•ä½“ç‰©ç†ä¼¤å®³ï¼Œä¼¤å®³éšç”Ÿå‘½å€¼é™ä½è€Œæé«˜"},
                    {name: "é’¢é“æ„å¿—", icon: "ğŸ¦¾", description: "æå‡æ”»å‡»åŠ›å’Œé˜²å¾¡åŠ›"}
                ],
                description: "å‡è¡¡çš„è¾“å‡ºè€…"
            }
        ];
    }




        // è§’è‰²æ•°æ®
        let characters = [];
        let selectedCharacters = [];
        let previewCharacter = null;

        // åˆå§‹åŒ–é¡µé¢
        function initSelectionPage() {
            // è·å–è§’è‰²æ•°æ®
            characters = getGameCharacters();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„é˜Ÿä¼
            const savedTeam = localStorage.getItem('hsr-selected-team');
            if (savedTeam) {
                try {
                    const teamData = JSON.parse(savedTeam);
                    if (teamData.characters && Array.isArray(teamData.characters)) {
                        // å°†ä¿å­˜çš„è§’è‰²IDè½¬æ¢ä¸ºå®é™…è§’è‰²
                        selectedCharacters = teamData.characters.map(savedChar => {
                            return characters.find(char => 
                                char.gameId === savedChar.id || 
                                char.name === savedChar.name
                            ) || characters[0]; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªè§’è‰²
                        }).filter(Boolean); // è¿‡æ»¤æ‰undefined
                        
                        // ç¡®ä¿æœ€å¤š4ä¸ªè§’è‰²
                        selectedCharacters = selectedCharacters.slice(0, 4);
                        
                        showMessage('å·²åŠ è½½ä¿å­˜çš„é˜Ÿä¼', 'success');
                    }
                } catch (e) {
                    console.error('åŠ è½½ä¿å­˜çš„é˜Ÿä¼å¤±è´¥:', e);
                }
            }
            
            renderSelectedCharacters();
            renderCharacterGrid();
            updateSelectionCount();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        }

        // æ¸²æŸ“å·²é€‰è§’è‰²åŒºåŸŸ
        function renderSelectedCharacters() {
            const container = document.getElementById('selectedCharacters');
            container.innerHTML = '';
            
            // åˆ›å»º4ä¸ªç©ºä½
            for (let i = 0; i < 4; i++) {
                if (selectedCharacters[i]) {
                    // å·²é€‰è§’è‰²çš„æ§½ä½
                    const character = selectedCharacters[i];
                    container.innerHTML += `
                        <div class="character-slot" data-index="${i}">
                            <div class="slot-avatar">${character.avatar}</div>
                            <div class="slot-info">
                                <div class="slot-name">${character.name}</div>
                                <div class="slot-path">${character.path}</div>
                            </div>
                            <div class="remove-btn" onclick="removeCharacter(${i})">Ã—</div>
                        </div>
                    `;
                } else {
                    // ç©ºæ§½ä½
                    container.innerHTML += `
                        <div class="empty-slot" onclick="showAvailableCharacters()">
                            <div class="slot-icon">â•</div>
                            <div>ç‚¹å‡»é€‰æ‹©è§’è‰²</div>
                        </div>
                    `;
                }
            }
        }

        // æ¸²æŸ“è§’è‰²é€‰æ‹©ç½‘æ ¼
        function renderCharacterGrid() {
            const container = document.getElementById('characterGrid');
            container.innerHTML = '';
            
            characters.forEach(character => {
                const isSelected = selectedCharacters.some(c => c.id === character.id);
                const isDisabled = isSelected && selectedCharacters.length === 4;
                
                container.innerHTML += `
                    <div class="character-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                         onclick="${isDisabled ? '' : `showCharacterPreview(${character.id})`}">
                        <div class="card-header">
                            <div class="card-avatar">${character.avatar}</div>
                            <div class="card-info">
                                <div class="card-name">${character.name}</div>
                                <div class="card-path">${character.path}</div>
                            </div>
                        </div>
                        
                        <div class="card-stats">
                            <div class="card-stat">
                                <span class="stat-icon">â¤ï¸</span>
                                <span class="stat-value">${character.hp}</span>
                            </div>
                            <div class="card-stat">
                                <span class="stat-icon">âš”ï¸</span>
                                <span class="stat-value">${character.attack}</span>
                            </div>
                            <div class="card-stat">
                                <span class="stat-icon">ğŸ›¡ï¸</span>
                                <span class="stat-value">${character.defense}</span>
                            </div>
                            <div class="card-stat">
                                <span class="stat-icon">âš¡</span>
                                <span class="stat-value">${character.speed}</span>
                            </div>
                        </div>
                        
                        <div class="card-skills">
                            ${character.skills.slice(0, 2).map(skill => 
                                `<span class="skill-tag">${skill.name}</span>`
                            ).join('')}
                        </div>
                        
                        ${isSelected ? '<div class="card-status">å·²é€‰æ‹©</div>' : ''}
                    </div>
                `;
            });
        }

        // æ˜¾ç¤ºè§’è‰²é¢„è§ˆ
        function showCharacterPreview(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;
            
            previewCharacter = character;
            
            // æ›´æ–°é¢„è§ˆå†…å®¹
            document.getElementById('previewAvatar').textContent = character.avatar;
            document.getElementById('previewName').textContent = character.name;
            document.getElementById('previewPath').textContent = character.path;
            document.getElementById('previewElement').textContent = character.element;
            document.getElementById('previewRarity').textContent = character.rarity;
            document.getElementById('previewHP').textContent = character.hp;
            document.getElementById('previewAttack').textContent = character.attack;
            document.getElementById('previewDefense').textContent = character.defense;
            document.getElementById('previewSpeed').textContent = character.speed;
            document.getElementById('previewCritRate').textContent = character.critRate;
            document.getElementById('previewCritDamage').textContent = character.critDamage;
            
            // æ›´æ–°æŠ€èƒ½
            const skills = ['previewSkill1', 'previewSkill2', 'previewSkill3', 'previewSkill4'];
            skills.forEach((skillId, index) => {
                const skillElement = document.getElementById(skillId);
                if (skillElement && character.skills[index]) {
                    const skill = character.skills[index];
                    skillElement.innerHTML = `
                        <div class="skill-name">
                            <span>${skill.icon || 'âœ¨'}</span>
                            <span>${skill.name}</span>
                        </div>
                        <div class="skill-desc">${skill.description}</div>
                    `;
                } else if (skillElement) {
                    skillElement.innerHTML = '';
                }
            });
            
            // æ˜¾ç¤ºé¢„è§ˆé¢æ¿
            document.getElementById('characterPreview').classList.add('active');
        }

        // å…³é—­é¢„è§ˆ
        function closePreview() {
            document.getElementById('characterPreview').classList.remove('active');
            previewCharacter = null;
        }

        // ä»é¢„è§ˆä¸­é€‰æ‹©è§’è‰²
        function selectFromPreview() {
            if (!previewCharacter) return;
            
            addCharacter(previewCharacter.id);
            closePreview();
        }

        // æ·»åŠ è§’è‰²åˆ°é˜Ÿä¼
        function addCharacter(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»é€‰æ‹©
            if (selectedCharacters.some(c => c.id === characterId)) {
                showMessage('è¯¥è§’è‰²å·²åœ¨é˜Ÿä¼ä¸­ï¼', 'warning');
                return;
            }
            
            // æ£€æŸ¥é˜Ÿä¼æ˜¯å¦å·²æ»¡
            if (selectedCharacters.length >= 4) {
                showMessage('é˜Ÿä¼å·²æ»¡ï¼ˆæœ€å¤š4äººï¼‰ï¼', 'warning');
                return;
            }
            
            // æ·»åŠ åˆ°é˜Ÿä¼
            selectedCharacters.push(character);
            showMessage(`${character.name} å·²åŠ å…¥é˜Ÿä¼ï¼`, 'success');
            
            // æ›´æ–°UI
            renderSelectedCharacters();
            renderCharacterGrid();
            updateSelectionCount();
        }

        // ç§»é™¤è§’è‰²
        function removeCharacter(index) {
            if (index < 0 || index >= selectedCharacters.length) return;
            
            const removed = selectedCharacters.splice(index, 1)[0];
            showMessage(`${removed.name} å·²ä»é˜Ÿä¼ä¸­ç§»é™¤`, 'info');
            
            renderSelectedCharacters();
            renderCharacterGrid();
            updateSelectionCount();
        }

        // é‡ç½®é€‰æ‹©
        function resetSelection() {
            if (selectedCharacters.length === 0) {
                showMessage('é˜Ÿä¼å·²ç»æ˜¯ç©ºçš„', 'info');
                return;
            }
            
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é€‰æ‹©å—ï¼Ÿ')) {
                selectedCharacters = [];
                showMessage('é˜Ÿä¼å·²é‡ç½®', 'success');
                
                renderSelectedCharacters();
                renderCharacterGrid();
                updateSelectionCount();
            }
        }

        // æ›´æ–°é€‰æ‹©è®¡æ•°
        function updateSelectionCount() {
            const countElement = document.getElementById('selectedCount');
            const startButton = document.getElementById('startBtn');
            
            countElement.textContent = selectedCharacters.length;
            
            // å¯ç”¨/ç¦ç”¨å¼€å§‹æŒ‰é’®
            startButton.disabled = selectedCharacters.length !== 4;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(text, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = text;
            messageBox.style.display = 'flex';
            
            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
            const colors = {
                info: 'var(--hsr-primary)',
                success: 'var(--hsr-success)',
                warning: 'var(--hsr-warning)',
                error: 'var(--hsr-danger)'
            };
            
            messageBox.style.color = colors[type] || colors.info;
            messageBox.style.borderColor = colors[type] || colors.info;
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºå¯ç”¨è§’è‰²æç¤º
        function showAvailableCharacters() {
            if (selectedCharacters.length === 4) {
                showMessage('é˜Ÿä¼å·²æ»¡ï¼Œè¯·å…ˆç§»é™¤è§’è‰²å†æ·»åŠ æ–°æˆå‘˜', 'warning');
            } else {
                showMessage('è¯·ä»ä¸‹æ–¹é€‰æ‹©è§’è‰²åŠ å…¥é˜Ÿä¼', 'info');
                
                // æ»šåŠ¨åˆ°è§’è‰²é€‰æ‹©åŒºåŸŸ
                document.querySelector('.character-select').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }

        // å¼€å§‹æˆ˜æ–—
        function startBattle() {
            if (selectedCharacters.length !== 4) {
                showMessage('è¯·é€‰æ‹©4åè§’è‰²ç»„æˆé˜Ÿä¼ï¼', 'warning');
                return;
            }
            
            // ä¿å­˜é˜Ÿä¼æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
            const teamData = {
                characters: selectedCharacters.map(char => ({
                    id: char.gameId || char.id,
                    name: char.name,
                    avatar: char.avatar,
                    path: char.path,
                    element: char.element.replace(/[^\w\s]/g, '').trim(), // ç§»é™¤è¡¨æƒ…ç¬¦å·
                    hp: char.hp,
                    attack: char.attack,
                    defense: char.defense,
                    speed: char.speed
                })),
                timestamp: new Date().getTime(),
                teamName: `å°é˜Ÿ${Math.floor(Math.random() * 1000)}`
            };
            
            localStorage.setItem('hsr-selected-team', JSON.stringify(teamData));
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showMessage('æ­£åœ¨è¿›å…¥æˆ˜æ–—...', 'info');
            
            // è·³è½¬åˆ°æˆ˜æ–—é¡µé¢
            setTimeout(() => {
                window.location.href = 'battle.html';
            }, 1500);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'Escape':
                    closePreview();
                    break;
                case 'Enter':
                    if (document.getElementById('characterPreview').classList.contains('active')) {
                        selectFromPreview();
                    }
                    break;
                case 'r':
                case 'R':
                    if (e.ctrlKey) {
                        resetSelection();
                    }
                    break;
            }
        });

        // ç­‰å¾…æ¸¸æˆæ•°æ®åŠ è½½å®Œæˆ
        function waitForGameData() {
            if (typeof GameData !== 'undefined') {
                initSelectionPage();
            } else {
                setTimeout(waitForGameData, 100);
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        window.addEventListener('DOMContentLoaded', waitForGameData);
    </script>
</body>
</html>